#!/usr/bin/env bun
// @bun
import"./speck-ac2ebaf8.js";import{B as Z,H as _,I as w,y as Y}from"./paths-x5kskk5z.js";import{existsSync as X,mkdirSync as A,copyFileSync as D}from"fs";import O from"path";var{$:I}=globalThis.Bun;function P(z){return{json:z.includes("--json"),help:z.includes("--help")||z.includes("-h")}}function T(){console.log(`Usage: setup-plan [--json]
  --json    Output results in JSON format
  --help    Show this help message`)}async function S(z){let Q=P(z);if(Q.help)return T(),0;let j=await w(),U=j.HAS_GIT==="true";if(!await _(j.CURRENT_BRANCH,U,j.REPO_ROOT))return 1;A(j.FEATURE_DIR,{recursive:!0});let q=j.CURRENT_BRANCH,V=await Z();if(U){try{if((await I`git rev-parse --abbrev-ref HEAD`.quiet()).text().trim()!==q)try{await I`git checkout ${q}`.quiet(),console.log(`[specify] Checked out branch: ${q}`)}catch{await I`git checkout -b ${q}`.quiet(),console.log(`[specify] Created and checked out branch: ${q}`)}}catch(v){console.error(`[specify] Warning: Could not manage git branch: ${v}`)}let K=j.FEATURE_SPEC;if(V.mode==="multi-repo"&&X(K)){let v=V.speckRoot,L=!1;try{if((await I`git -C ${v} rev-parse --git-dir`.quiet()).exitCode===0)L=!0}catch{}if(L)try{let W=(await I`git -C ${v} rev-parse --abbrev-ref HEAD`.quiet()).text().trim();if(W!==q)console.error("[specify] Warning: Parent repo branch mismatch!"),console.error(`[specify]   Child repo (current): ${q}`),console.error(`[specify]   Parent repo: ${W}`),console.error(`[specify]   Parent location: ${v}`),console.error("[specify] Consider checking out matching branch in parent:"),console.error(`[specify]   git -C ${v} checkout ${q}`)}catch(M){console.error(`[specify] Warning: Could not check parent repo branch: ${M}`)}}}let J=O.join(Y(),"plan-template.md");if(X(J))D(J,j.IMPL_PLAN),console.log(`Copied plan template to ${j.IMPL_PLAN}`);else console.log(`Warning: Plan template not found at ${J}`),await Bun.write(j.IMPL_PLAN,"");if(Q.json){let K={FEATURE_SPEC:j.FEATURE_SPEC,IMPL_PLAN:j.IMPL_PLAN,SPECS_DIR:j.FEATURE_DIR,BRANCH:j.CURRENT_BRANCH,HAS_GIT:j.HAS_GIT};console.log(JSON.stringify(K))}else console.log(`FEATURE_SPEC: ${j.FEATURE_SPEC}`),console.log(`IMPL_PLAN: ${j.IMPL_PLAN}`),console.log(`SPECS_DIR: ${j.FEATURE_DIR}`),console.log(`BRANCH: ${j.CURRENT_BRANCH}`),console.log(`HAS_GIT: ${j.HAS_GIT}`);return 0}export{S as main};
